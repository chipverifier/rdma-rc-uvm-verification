# RDMA 协议范围定义（Protocol Scope）

## 1. 文档目的与适用范围

本文档用于明确本项目中 **RDMA 协议的能力边界与行为假设**，用于约束后续架构设计、接口定义与验证策略。

本文档回答的问题是：

* 这个项目中的 RDMA **算什么**
* 这个项目中的 RDMA **不算什么**

本文档刻意不讨论以下内容：

* RTL 或微架构实现方式
* 时序、流水线与性能优化
* 具体验证方法与测试策略

---

## 2. RDMA 协议定位说明

### 2.1 协议类型

本项目当前阶段 **明确以 RoCEv2（RDMA over Converged Ethernet v2）为协议基础模型**。

协议假设：

* 基于以太网承载
* 使用 UDP/IP 作为网络层封装
* 不涉及 InfiniBand 物理层或链路层细节

本项目并不追求 RoCEv2 的完整标准实现，而是实现其 **可裁剪子集（Subset）**，用于系统级建模与工程演进。

### 2.2 与标准 RoCEv2 的关系

* 行为语义参考 RoCEv2
* 报文结构允许简化
* 部分协议字段可能被省略或抽象
* 标准中的高级特性不在当前 Scope 内

---

## 3. 支持的 RDMA 操作语义

### 3.1 当前支持的操作类型

当前阶段支持以下 RDMA 操作：

* SEND
* RDMA WRITE

上述操作用于构建最小可运行的 RDMA 数据通路闭环。

### 3.2 暂不支持的操作类型

当前阶段明确不支持：

* RDMA READ
* Atomic 操作（Fetch-and-Add、Compare-and-Swap 等）

上述操作被视为后续扩展能力。

---

## 4. 通信与可靠性模型

### 4.1 QP 抽象

系统采用 Queue Pair（QP）作为基本通信抽象。

当前阶段假设：

* QP 为一对逻辑通信端点
* 每个 QP 独立维护上下文状态

### 4.2 可靠性假设

当前阶段的可靠性模型为 **简化可靠模型**：

* 假设网络环境基本可靠
* 不强制要求处理丢包、乱序等异常情况
* 不实现完整的 RoCEv2 重传协议

---

## 5. 顺序性与并发模型

### 5.1 请求顺序保证

在单 QP 范围内：

* 请求按提交顺序处理
* Completion 按请求顺序返回

### 5.2 并发能力限制

当前阶段并发能力限制为：

* 每个 QP 仅支持有限数量的 Outstanding 请求
* 不支持乱序完成

并发深度作为可参数化扩展点保留。

---

## 6. 状态模型边界

### 6.1 QP 状态模型

当前阶段 QP 状态模型保持简化：

* 初始化状态
* 就绪状态
* 错误状态（可选）

不引入完整 IB/RoCE 状态机复杂度。

### 6.2 请求生命周期

单个 RDMA 请求的生命周期包括：

* 请求注入
* 协议处理
* 报文发送
* 报文接收
* Completion 生成

---

## 7. 报文层级抽象

### 7.1 报文抽象层级

报文在逻辑层面抽象为：

* 协议头
* 控制信息
* 数据负载（Payload）

不在当前阶段定义比特级格式。

### 7.2 TX / RX 责任边界

* TX 路径负责协议封装与报文生成
* RX 路径负责协议解析与语义恢复

---

## 8. 错误与异常处理策略

当前阶段仅处理以下异常类型：

* 非法请求参数
* 明确的协议违规行为

以下异常不作为必须处理项：

* 网络丢包
* 报文乱序
* 超时与重传

---

## 9. 明确不在当前 Scope 内的能力

当前阶段明确排除以下能力：

* 完整 RoCEv2 规范支持
* 拥塞控制（ECN、DCQCN 等）
* 高级流控机制
* 安全与加密机制
* 性能与吞吐量指标约束

---

## 10. 与后续文档的关系

* 本文档为 `02_architecture.md` 提供协议前提条件
* 架构设计不得违反本文档定义的协议范围
* 接口设计与验证计划应以本文档为边界依据

任何协议能力的扩展，必须首先更新本文档。
